<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"> <!-- 문서 인코딩을 UTF-8로 설정 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- 모바일 뷰포트 설정 -->
    <title>단어 상세 - TOEIC Vocabulary</title> <!-- 브라우저 탭에 표시될 제목 -->

    <!-- 스타일시트 연결 -->
    <link rel="stylesheet" href="style.css"> <!-- 공통 스타일 -->
    <link rel="stylesheet" href="css/vocabulary.css"> <!-- 단어장 관련 스타일 -->
    <link rel="stylesheet" href="css/seemore.css"> <!-- 단어 상세 페이지 전용 스타일 -->
</head>
<body>
    <!-- 상단 바 -->
    <nav class="nav-bar">
        <div class="nav-logo">
            <img src="assets/enpick-logo.png" alt="EnPick 로고" /> <!-- 로고 이미지 -->
            <h2>EnPick</h2> <!-- 로고 텍스트 -->
        </div>
        <div class="nav-user">
            <!-- vocabulary.html과 동일한 로그아웃 기능을 위해 id를 지정하고 href="#"로 변경 -->
            <a href="#" id="logoutBtn" class="logout-btn">로그아웃</a>
        </div>
    </nav>

    <!-- 사이드바 -->
    <div class="sidebar">
        <!-- 각 메뉴 항목 -->
        <a href="home.html" class="menu-item">홈</a>
        <a href="vocabulary.html" class="menu-item active">단어장</a> <!-- 현재 페이지 강조 -->
        <a href="#" class="menu-item">학습</a>
        <a href="#" class="menu-item">테스트</a>
        <a href="#" class="menu-item">통계</a>
    </div>

    <!-- 메인 콘텐츠 영역 -->
    <div class="main-content">
        <h1>단어 상세</h1>
        <div class="word-detail">
            <!-- 단어 제목과 품사 -->
            <div class="word-header">
                <h1 id="word-title" class="word-title"></h1> <!-- 단어명 표시 -->
                <div id="word-info" class="word-info"></div> <!-- 품사 표시 -->
            </div>

            <!-- 의미 섹션 -->
            <div class="meaning-section">
                <h2 class="meaning-title">의미</h2>
                <p id="meaning-content" class="meaning-content"></p> <!-- 의미 표시 -->
            </div>

            <!-- 예문 섹션 -->
            <div class="meaning-section">
                <h2 class="meaning-title">예문</h2>
                <div class="example">
                    <p id="example-en" class="example-text"></p> <!-- 영어 예문 -->
                    <p id="example-ko" class="example-translation"></p> <!-- 한글 해석 -->
                </div>
            </div>

            <!-- 관련 단어 (유의어/반의어) 섹션 -->
            <div class="meaning-section">
                <h2 class="meaning-title">관련 단어</h2>
                <ul>
                    <li><strong>유의어:</strong> <span id="synonym"></span></li> <!-- 유의어 -->
                    <li><strong>반의어:</strong> <span id="antonym"></span></li> <!-- 반의어 -->
                </ul>
            </div>

            <!-- 뒤로가기 버튼 -->
            <a href="vocabulary.html" class="back-button">단어장으로 돌아가기</a>
        </div>
    </div>

    <!-- 단어 정보 로드 및 로그아웃 기능용 스크립트 -->
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        // 1. 로그인 상태 확인 (세션 기반)
        try {
          const res = await fetch('/api/me', { credentials: 'include' });
          if (!res.ok) throw new Error();
          const user = await res.json();
          // 사용자 이메일 표시 (선택 사항)
          const userSpan = document.createElement('span');
          userSpan.textContent = `${user.email}님`;
          document.querySelector('.nav-user')?.prepend(userSpan);
        } catch (err) {
          alert('로그인이 필요합니다.');
          window.location.href = 'login.html';
          return;
        }

        // 2. 로그아웃 기능: vocabulary.html과 동일하게 POST /logout 호출 후 로그인 페이지로 이동
        document.getElementById('logoutBtn')?.addEventListener('click', async () => {
          try {
            await fetch('/logout', {
              method: 'POST',
              credentials: 'include'
            });
          } catch (err) {
            console.error('서버 로그아웃 실패:', err);
          }
          // localStorage 세션 정보 삭제 (있을 경우)
          localStorage.removeItem('isLoggedIn');
          localStorage.removeItem('userRole');
          window.location.href = 'login.html';
        });

        // 3. URL 파라미터에서 단어의 id (wordId) 정보를 가져옴
        const params = new URLSearchParams(window.location.search);
        const wordId = params.get('wordId');
        
        if (!wordId) {
          alert('단어 정보가 없습니다.');
          return;
        }
        
        try {
          // 기본 단어 정보를 가져오기 위해 /api/words를 호출 후, 해당 wordId에 맞는 데이터를 찾음
          const wordsResponse = await fetch('http://localhost:3000/api/words');
          if (!wordsResponse.ok) throw new Error('단어 리스트를 가져올 수 없습니다.');
          const words = await wordsResponse.json();
          const wordData = words.find(item => String(item.id) === wordId);
          if (!wordData) throw new Error('단어를 찾을 수 없습니다.');
          
          // 상세 정보는 /api/details/:wordId로 가져옴 (없으면 기본값 사용)
          let detailsData = { synonym: '', antonym: '', example: '', example_kor: '' };
          const detailsResponse = await fetch(`http://localhost:3000/api/details/${wordId}`);
          if (detailsResponse.ok) {
              detailsData = await detailsResponse.json();
          }
          
          // 응답 받은 데이터를 HTML 요소에 삽입
          document.getElementById('word-title').textContent = wordData.word;
          document.getElementById('word-info').textContent = `[${wordData.part_of_speech}]`;
          document.getElementById('meaning-content').textContent = wordData.meaning;
          document.getElementById('example-en').textContent = detailsData.example || '';
          document.getElementById('example-ko').textContent = detailsData.example_kor || '';
          document.getElementById('synonym').textContent = detailsData.synonym || '';
          document.getElementById('antonym').textContent = detailsData.antonym || '';
          
        } catch (error) {
          console.error('❌ 오류 발생:', error);
          alert('단어 정보를 불러오지 못했습니다.');
        }
      });
    </script>
</body>
</html>
